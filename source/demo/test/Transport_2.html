<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-15" />
  <title>qooxdoo demo</title>
  <link type="text/css" rel="stylesheet" href="../demolayout.css"/>
  <script type="text/javascript" src="../demoinclude.js"></script>
</head>
<body>
  <script type="text/javascript" src="../demolayout.js"></script>

  <div id="demoDescription">
    <p>Testing different file sizes with timeouts and other built-in transport features.</p>
  </div>

  <script type="text/javascript">
  window.application.main = function()
  {
    var d = this.getClientWindow().getClientDocument();

    var lay = new QxVerticalBoxLayout;
    lay.setLocation(20, 48);
    lay.setRight(335);
    lay.setBottom(48);
    this.add(lay);



    var fsq = new QxFieldSet("Request");
    fsq.setHeight("auto");
    lay.add(fsq);


    var hlay = new QxHorizontalBoxLayout;
    hlay.setVerticalChildrenAlign("middle");
    hlay.setSpacing(4);
    hlay.auto();
    fsq.add(hlay);


    var cm1 = new QxComboBox();
    cm1.add(new QxListItem("data/filesize/40kb.xml"));
    cm1.add(new QxListItem("data/filesize/400kb.xml"));
    cm1.add(new QxListItem("data/filesize/4000kb.xml"));
    cm1.setSelected(cm1.getList().getFirstChild());
    cm1.setWidth(200);
    cm1.addEventListener("changeSelected", upd);

    hlay.add(cm1);



    var async = new QxCheckBox("Async");
    async.setChecked(true);
    hlay.add(async);


    var spin = new QxSpinner(1);
    hlay.add(spin);



    var btn = new QxButton("Send", "icons/16/apply.png");
    btn.addEventListener("execute", upd);
    hlay.add(btn);


    var inf = new QxTextField("State");
    inf.setWidth(80);
    hlay.add(inf);


    var code = new QxTextField("Code");
    code.setWidth(40);
    hlay.add(code);



    var checken = new QxCheckBox("enabled");
    checken.setChecked(true);
    hlay.add(checken);

    checken.addEventListener("changeChecked", function(e) {
      QxRequestQueue.setEnabled(e.getData());
    });





    var fsr = new QxFieldSet("Result");
    fsr.setHeight("1*");
    lay.add(fsr);

    var area = new QxLabel("Disabled because of large filesize");
    fsr.add(area);









    function upd(e)
    {
      var val = cm1.getSelected();

      if (!val) {
        return;
      };

      var req;
      for( var i=0, max=parseInt(spin.getValue()); i<max; i++ ) {
        req = new QxGetRequest(val.getLabel());
        req.setAsynchronous(async.getChecked());

        req.addEventListener("sending", function(e) {
          inf.setValue("Sending");
        });

        req.addEventListener("receiving", function(e) {
          inf.setValue("Receiving");
        });

        req.addEventListener("completed", function(e)
        {
          inf.setValue("Completed");
          code.setValue(e.getData().getStatusCode().toString());
        });

        req.addEventListener("failed", function(e)
        {
          inf.setValue("Failed");
          code.setValue(e.getData().getStatusCode().toString());
        });

        req.addEventListener("timeout", function(e)
        {
          inf.setValue("Timeout");
          code.setValue(e.getData().getStatusCode().toString());
        });

        req.addEventListener("aborted", function(e)
        {
          inf.setValue("Aborted");
          code.setValue(e.getData().getStatusCode().toString());
        });

        req.send();
      };
    };
  };
  </script>
</body>
</html>