<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>qooxdoo &raquo; Demo Browser</title>
  <script type="text/javascript">
    qxsettings =
    {
      "qx.disposerDebugLevel"     : 0
    };
    qxvariants =
    {
      "qx.debug" : "on"
    };
  </script>
  <script type="text/javascript" src="../../script/demo.js"></script>
  <script type="text/javascript" src="../util.js"></script>
</head>
<body>
  <div id="description">
    <p>
      Example of Progressive rendering of a table using widgets for the table
      rows.
    </p>
  </div>

  <script type="text/javascript">
  qx.Class.define("BasicSample",
  {
    extend : qx.application.Gui,

    members :
    {
      main : function()
      {
        this.base(arguments);
        var d = qx.ui.core.ClientDocument.getInstance();

        var nextId = 0;
        var createRandomRows = function(rowCount) {
          var rowData = [];
          var now = new Date().getTime();
          var dateRange = 400 * 24 * 60 * 60 * 1000; // 400 days
          for (var row = 0; row < rowCount; row++) {
            var date = new Date(now + Math.random() * dateRange - dateRange / 2);
            rowData.push(
                         {
                           renderer : "row",
                           location : row == rowCount - 1 ? "start" : "end",
                           data     : [
                                       nextId++,
                                       Math.random() * 10000,
                                       date,
                                       (Math.random() > 0.5)
                                      ]
                         });
          }
          return rowData;
        };

        // Instantiate a Progressive
        var structure = new qx.ui.progressive.structure.Default();
        var progressive = new qx.ui.progressive.Progressive(structure);

        // Instantiate a data model and populate it.
        var dataModel = new qx.ui.progressive.model.Default();
        var rowData = createRandomRows(50);
        dataModel.addElements(rowData);

        // Tell Progressive about its data model
        progressive.setDataModel(dataModel);

        // Specify the cell styles
        var cellStyles =
          [
            {
              width     : 200
            },
            {
              width     : 200
            },
            {
              width     : "1*"
            },
            {
              width     : 200
            }
          ];
        
        // Specify the label styles
        var labelStyles =
          [
            {
              textAlign : "right"
            },
            {
              textAlign : "right"
            },
            {
              textAlign : "center",
              font      : new qx.ui.core.Font(null, [ "monospace" ])
            },
            {
            }
          ];

        // Instantiate a table row renderer
        var renderer = new TableRowWidget(cellStyles, labelStyles);

        // Give Progressive the renderer, and assign a name
        progressive.addRenderer("row", renderer);

        d.add(progressive);

        progressive.render();
      }
    }
  });

  qx.Class.define("TableRowWidget",
  {
    extend     : qx.ui.progressive.renderer.Abstract,


    /**
     */
    construct : function(columnStyleArr, labelStyleArr)
    {
      this.base(arguments);

      // Save the column and label styles
      this._columnStyle = columnStyleArr;
      this._labelStyle = labelStyleArr;

      // Create a border for cell style
      var border = new qx.ui.core.Border();
      border.setRight(1, "solid", "#dddddd");
      border.setBottom(1, "solid", "#dddddd");
      this._border = border;
    },


    members :
    {
      /**
       */
      render : function(state, element)
      {
        var cell;
        var style;
        var data = element.data;

        // Instantiate a horizontal box for the row
        var row = new qx.ui.layout.HorizontalBoxLayout();
        row.set(
          {
            spacing : 4,
            height  : "auto"
          });

        // For each cell...
        for (var i = 0; i < data.length; i++)
        {
          // Render this cell
          cell = new qx.ui.basic.Atom(data[i].toString());
          cell.set(
            {
              border  : this._border,
              height  : "100%"
            });

          columnStyle = this._columnStyle[i];
          if (columnStyle)
          {
              cell.set(columnStyle);
          }

          if (state.current % 2 == 0 && i == 1)
          {
            cell.setHeight(32);
          }

          labelStyle = this._labelStyle[i];
          if (labelStyle)
          {
            if (! labelStyle.width)
            {
              labelStyle.width = "100%";
            }
            cell.getLabelObject().set(labelStyle);
          }
          row.add(cell);
        }

        // Add this row to the table
        switch(element.location)
        {
        case "end":
          state.pane.add(row);
          break;

        case "start":
          state.pane.addAtBegin(row);
          break;

        default:
          throw new Error("Invalid location: " + element.location);
        }
      }
    }
  });

  qx.core.Init.getInstance().setApplication(new BasicSample);
  </script>
</body>
</html>
