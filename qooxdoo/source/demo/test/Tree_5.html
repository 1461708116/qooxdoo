<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-15" />
  <title>qooxdoo demo</title>
  <link type="text/css" rel="stylesheet" href="../demolayout.css"/>
  <script type="text/javascript" src="../demoinclude.js"></script>
</head>
<body>
  <script type="text/javascript" src="../demolayout.js"></script>

  <div id="demoDescription">
    <p>Drag and Drop between trees and inside a tree.</p>
  </div>

  <script type="text/javascript">
    window.application.main = function()
    {
      function handleDragStart(e) 
      {
        e.addData("QxTreeElement", e.getCurrentTarget());
        e.addAction("move");
        e.startDrag();
      };

      function handleDragDrop(e) 
      {
        var vType = e.getDropDataTypes()[0];
        var vSource = e.getData(vType);
        var vTarget = e.getCurrentTarget();
        
        vSource.getTree().getManager().deselectAll();
        vTarget.add(vSource);
        
        e.stopPropagation();
      }; 
      
      function supportsDrop(vDragCache) {
        return !vDragCache.sourceWidget.contains(this);
      };

      function handleDragOver(e)
      {
        var l = e.getTarget().getLabelObject();
        l.setStyleProperty("textDecoration", "underline");
      };
    
      function handleDragOut(e) 
      {
        var l = e.getTarget().getLabelObject();
        l.removeStyleProperty("textDecoration");
      };



      var treeSource = new QxTree("Source");

      with(treeSource)
      {
        setBackgroundColor(255);
        setBorder(QxBorderObject.presets.thinInset);
        setOverflow("scrollY");

        setHeight(null);
        setTop(48);
        setLeft(20);
        setWidth(200);
        setBottom(48);
        
        addEventListener("dragdrop", handleDragDrop); 
        addEventListener("dragover", handleDragOver);
        addEventListener("dragout", handleDragOut);

        setDropDataTypes(["QxTreeElement"]);
      };

      this.add(treeSource);
      
      for (var i=1, f; i<4; i++)
      {
        f = new QxTreeFolder("Folder " + i);
        
        f.addEventListener("dragstart", handleDragStart);
        f.addEventListener("dragdrop", handleDragDrop); 
        f.addEventListener("dragover", handleDragOver);
        f.addEventListener("dragout", handleDragOut);
        
        f.setDropDataTypes(["QxTreeElement"]);
        f.supportsDrop = supportsDrop;
        
        treeSource.add(f);
        
        for (var j=1, g; j<4; j++)
        {
          g = new QxTreeFolder("Subfolder " + j);
          
          g.addEventListener("dragstart", handleDragStart);
          g.addEventListener("dragdrop", handleDragDrop); 
          g.addEventListener("dragover", handleDragOver);
          g.addEventListener("dragout", handleDragOut);
          
          g.setDropDataTypes(["QxTreeElement"]);
          g.supportsDrop = supportsDrop;
          
          f.add(g);
          
          for (var k=1, h; k<4; k++)
          {
            h = new QxTreeFile("File " + k);
            
            h.addEventListener("dragstart", handleDragStart);
            
            g.add(h);
          };
        };
      };




      var treeDest = new QxTree("Dest");

      with(treeDest)
      {
        setBackgroundColor(255);
        setBorder(QxBorderObject.presets.thinInset);
        setOverflow("scrollY");

        setHeight(null);
        setTop(48);
        setLeft(240);
        setWidth(200);
        setBottom(48);
        
        addEventListener("dragdrop", handleDragDrop); 
        addEventListener("dragover", handleDragOver);
        addEventListener("dragout", handleDragOut);

        setDropDataTypes(["QxTreeElement"]);
      };

      this.add(treeDest);
    };
  </script>
</body>
</html>
