<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-15" />
  <title>qooxdoo demo</title>
  <link type="text/css" rel="stylesheet" href="../demolayout.css"/>
  <script type="text/javascript" src="../demoinclude.js"></script>
</head>
<body>
  <script type="text/javascript" src="../demolayout.js"></script>

  <div id="demoDescription">
    <p>Testing multiple parallel requests of files with different sizes.</p>
  </div>

  <script type="text/javascript">
  window.application.main = function()
  {
    var lab1 = new QxLabel("40KB");
    var lab2 = new QxLabel("400KB");
    var lab3 = new QxLabel("4000KB");

    var spin1 = new QxSpinner(0, 3, 50);
    var spin2 = new QxSpinner(0, 3, 20);
    var spin3 = new QxSpinner(0, 3, 10);




    var grid = new QxGridLayout;

    grid.setLocation(20, 48);
    grid.setDimension(QxConst.CORE_AUTO, QxConst.CORE_AUTO);
    grid.setHorizontalSpacing(10);
    grid.setVerticalSpacing(4);
    grid.setBorder(qx.renderer.border.BorderObject.presets.thinOutset);
    grid.setBackgroundColor("white");
    grid.setPadding(10);

    grid.setColumnCount(3);
    grid.setRowCount(2);

    grid.setColumnWidth(0, 50);
    grid.setColumnWidth(1, 50);
    grid.setColumnWidth(2, 50);

    grid.setRowHeight(0, 18);
    grid.setRowHeight(1, 22);

    this.add(grid);

    grid.add(lab1, 0, 0);
    grid.add(lab2, 1, 0);
    grid.add(lab3, 2, 0);

    grid.add(spin1, 0, 1);
    grid.add(spin2, 1, 1);
    grid.add(spin3, 2, 1);



    var btn = new QxButton("Send", "icons/16/button-ok.png");
    btn.setLocation(20, 120);
    this.add(btn);



    var area = new QxTextArea("");
    area.setLocation(20, 154);
    area.setDimension(192, 400);
    this.add(area);



    btn.addEventListener("execute", function(e)
    {
      var s1 = parseInt(spin1.getValue());
      var s2 = parseInt(spin2.getValue());
      var s3 = parseInt(spin3.getValue());

      while ((s1+s2+s3) > 0)
      {
        if (s1 > 0)
        {
          makeRequest(40);
          s1--;
        };

        if (s2 > 0)
        {
          makeRequest(400);
          s2--;
        };

        if (s3 > 0)
        {
          makeRequest(4000);
          s3--;
        };
      };
    });

    function makeRequest(size)
    {
      var req = new QxRequest("data/filesize/" + size + "kb.xml", "GET", "application/xml");

      req.addEventListener("completed", function(e) {
        area.setValue(area.getValue() + "Request " + size + "kb: completed\n");
      });

      req.addEventListener("failed", function(e) {
        area.setValue(area.getValue() + "Request " + size + "kb: failed\n");
      });

      req.addEventListener("timeout", function(e) {
        area.setValue(area.getValue() + "Request " + size + "kb: timeout\n");
      });

      req.send();
    };
  };
  </script>
</body>
</html>